---
title: BMONZ 서비스 구축 Part 1
layout: post
permalink: /project/bmonzpart1
posttype: project
post-image: https://cdn.bouldermon.com/project/project00003/initial.jpg
description: 프로젝트 생성 및 로컬 개발환경 설정
tags:
- TECH
- SPRING
- DOCKER
---

### BMONZ 란?
BMONZ는 **B**log **MON**ster**Z**의 약자로 블로그몬의 회원관리 서비스를 제공할 예정이다.
- 회원가입
- 로그인
- 로그아웃
- JWT 인증

### BMONZ 서비스 기술 스택
- Springboot 3.2.2
- Java 21 (OpenJDK 21.0.2)
- Gradle 8.5
- Mybatis 3
- Postgresql

### BMONZ 서비스 구성도
목표 설계도는 아래와 같다. 정적 리소스들에 대한 처리는 [CloudFront와 S3를 이용한 CDN](https://blog.bouldermon.com/project/blogmoncdnpart1)으로 처리하며, BMONZ와 같은 동적 리소스 처리는 **Amazon API Gateway**와 **Lightsail instance**를 이용해 처리할 예정이다.

<p align="center">
  <img src="https://cdn.bouldermon.com/project/project00003/overview.png">
</p>

### BMONZ 어플리케이션 초기 설정
#### springboot 프로젝트 생성
어플리케이션을 띄우기 위한 최소한의 Dependencies만 추가하여 **spring initializr**를 이용해 프로젝트를 생성했다.

<p align="center">
  <img src="https://cdn.bouldermon.com/project/project00003/springinitializr.png">
</p>

API 문서 생성 및 관리를 위해 **swagger**도 Dependencies에 추가했다. **springboot v3**를 지원하는 `springdoc-openapi v2.3.0`로 추가했다.

```gradle
dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.3.0' // swagger-ui
	compileOnly 'org.projectlombok:lombok'
	developmentOnly 'org.springframework.boot:spring-boot-devtools'
	annotationProcessor 'org.projectlombok:lombok'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'
}
```
<br/>

#### 테스트 API 생성
단순 동작여부 확인을 위해 테스트용 API를 생성했다.

```java
@RestController
@RequiredArgsConstructor
@Slf4j
@RequestMapping("/bmonz")
public class MemberController {

    @Operation(summary = "BMONZ 회원가입", description = "신규 계정을 생성한다.")
    @PostMapping("/signup")
    public ResponseEntity<?> signup() {

        log.info("loggging test");
        return new ResponseEntity<>("signup BMONZ", HttpStatus.OK);
    }
}
```
<br/>

`Slf4j`와 `Swagger`가 정상 동작하는지 확인 한 후 다음 스텝으로 진행했다.

<p align="center">
  <img src="https://cdn.bouldermon.com/project/project00003/local_run.png">
</p>


#### Github Repository 연결
Github에서 Public Repository를 생성했다. `.gitignore` 혹은 `README` 파일 등은 선택하지 않았다.

<p align="center">
  <img src="https://cdn.bouldermon.com/project/project00003/github_repo_create.png">
</p>

위에서 생성한 로컬 프로젝트를 Intellij Terminal을 통해 Github Repository에 push했다.

```bash
# Github에서 제공하는 스크립트
echo "# bmonz-api" >> README.md
git init
git add README.md
git commit -m "first commit"
git branch -M main
git remote add origin https://github.com/yourbran/bmonz-api.git
git push -u origin main
```

### 로컬 개발환경 구성
> BMONZ는 Docker를 이용한 MSA 어플리케이션으로 개발할 것이다. 개발 도구는 intellij를 사용할 것이며 **Docker plugin**을 설치하여 로컬 테스트를 진행한다.

#### Dockerfile 작성
Spring에서 제공하는 [Spring Boot Docker](https://spring.io/guides/topicals/spring-boot-docker/) 가이드를 참고하여 `Dockerfile`을 작성한다.

```Dockerfile
FROM amazoncorretto:21.0.2-alpine3.19
MAINTAINER yourbran

ARG JAR_FILE=bmonz-0.0.1-SNAPSHOT.jar

RUN mkdir -p /app
WORKDIR /app

COPY build/libs/${JAR_FILE} /app/bmonz.jar
COPY scripts/run.sh /app

ENTRYPOINT ["./run.sh"] 
```
<br/>

`ENTRYPOINT`부분을 보면 `./run.sh`을 통해 java를 실행시킬 예정이다. 이럴 경우 base image에서 제공하는 `/bin/sh`의 문법을 사용하여 java를 구동시킬 수 있다.

<p align="center">
  <img src="https://cdn.bouldermon.com/project/project00003/run_sh.png">
</p>

Runtime시 필요한 설정을 적용해야하는 경우를 대비해서 `./run.sh`에선 `${JAVA_OPT}`을 통해 command line argument를 전달받도록했다.

#### Bind Port
Docker를 실행하기에 앞서 Docker Conatainer와 Host간의 포트를 연결해주어야 한다. intellij **Run Configurations**에서 설정이 가능하다. 테스트를 위한 것이므로 기본 포트인 8080을 설정했다.

<p align="center">
  <img src="https://cdn.bouldermon.com/project/project00003/intellij_docker_bind_port.png">
</p>

#### Run on Docker
Docker Plugin이 설치되어 있다면 `Dockerfile`에서 `Run on Docker`를 클릭하여 바로 Docker를 실행시킬 수 있다.

<p align="center">
  <img src="https://cdn.bouldermon.com/project/project00003/dockerfile_run_button.png">
</p>

Docker process가 정상적으로 올라왔고, **Swagger-UI** 및 **Slf4j**의 logging 테스트까지 정상적으로 실행되는 것을 확인했다.

<p align="center">
  <img src="https://cdn.bouldermon.com/project/project00003/intellij_docker_run.png">
</p>

### 이어서
BMONZ를 빌드, 테스트, 배포를 하기 위한 CI/CD 환경을 구성하려 한다. AWS의 서비스들을 이용해 볼 예정이며 설계도는 아래와 같다.

<p align="center">
  <img src="https://cdn.bouldermon.com/project/project00004/overview.png">
</p>